# DEV_DOC

## Goal
Developer-focused notes to set up, build, run, and maintain the Inception stack.

## Prerequisites
- Linux host with sudo
- Docker >= 20.10 and Docker Compose v2
- mkcert + libnss3-tools for local TLS
- Git to fetch the repository

## Environment Setup (from scratch)
1) Clone and enter:
```bash
git clone <repository-url>
cd inception
```
2) Ensure your user is in the `docker` group (then re-login):
```bash
sudo usermod -aG docker $USER
```
3) Add local domain mapping for HTTPS:
```
127.0.0.1 lpaixao-.42.fr localhost
127.0.1.1 lpaixao-.42.fr
```
4) Create secrets files (gitignored) in `project/secrets/`:
```
db_password.txt        # WordPress DB user password
db_root_password.txt   # MariaDB root password
wp_password.txt        # WordPress admin password
```
5) Install TLS tools and generate certs (inside `project/`):
```bash
make cert-install-tools
make cert-renew
```

## Build and Launch
```bash
cd project
make all       # builds images, creates network/volumes, starts containers
```
- Compose file: `project/srcs/docker-compose.yml` (services: nginx, wordpress, mariadb).
- Make targets wrap `docker compose` for consistency.

## Useful Commands
- Status: `make ps`
- Logs: `make logs`, or service-specific `make logs-nginx`, `make logs-wordpress`, `make logs-mariadb`
- Shells: `make shell-nginx`, `make shell-wordpress`, `make shell-mariadb`
- Rebuild from scratch: `make re`
- Tear down:
```bash
make stop      # stop containers
make down      # remove containers, keep volumes
make clean     # remove images and network, keep volumes
make fclean    # remove containers, images, network, volumes
```

## Manage Containers and Volumes Directly
```bash
# Compose shortcuts
cd project
docker compose -f ./srcs/docker-compose.yml ps

# Volumes
docker volume ls | grep inception
docker volume inspect inception_mariadb
docker volume inspect inception_wordpress
```

## Data and Persistence
- WordPress data: named volume `inception_wordpress` stored under `/var/lib/docker/volumes/inception_wordpress/_data/`.
- MariaDB data: named volume `inception_mariadb` stored under `/var/lib/docker/volumes/inception_mariadb/_data/`.
- TLS assets: generated by mkcert in `project/srcs/requirements/nginx/tools/` (copied into the image at build).
- Secrets: `project/secrets/*.txt` (never committed); containers read them at startup.

## Notes for Development
- Keep container users non-root; avoid adding sudo inside containers.
- When changing configs or Dockerfiles, rebuild with `make re` to ensure layers refresh.
- If you modify domain or certificates, regenerate with `make cert-renew` and restart (`make restart`).
